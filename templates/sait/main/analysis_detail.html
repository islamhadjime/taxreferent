<!-- main/templates/sait/main/analysis_detail.html -->
{% extends "sait/main/Base2.html" %}
{% load static %}

{% block content %}
<style>
.analysis-detail {
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px;
}

.analysis-header {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 30px;
    border-radius: 12px;
    margin-bottom: 30px;
}

.analysis-title {
    font-size: 28px;
    font-weight: 700;
    margin-bottom: 10px;
}

.analysis-meta {
    display: flex;
    gap: 30px;
    flex-wrap: wrap;
    margin-top: 15px;
}

.meta-item {
    display: flex;
    align-items: center;
    gap: 8px;
}

.risk-score {
    font-size: 48px;
    font-weight: bold;
    text-align: center;
    margin: 20px 0;
}

.score-low { color: #28a745; }
.score-medium { color: #ffc107; }
.score-high { color: #dc3545; }

.result-badge {
    display: inline-block;
    padding: 8px 16px;
    border-radius: 20px;
    font-weight: bold;
    font-size: 16px;
}

.result-positive {
    background: #d4edda;
    color: #155724;
}

.result-warning {
    background: #fff3cd;
    color: #856404;
}

.result-negative {
    background: #f8d7da;
    color: #721c24;
}

/* –°—Ç–∏–ª–∏ –¥–ª—è –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã—Ö –∫—Ä–∏—Ç–µ—Ä–∏–µ–≤ */
.criteria-section {
    margin: 30px 0;
}

.criteria-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 15px;
    margin: 20px 0;
}

.criterion-card {
    background: white;
    padding: 15px;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    border-left: 4px solid #e9ecef;
    cursor: pointer;
    transition: all 0.3s ease;
    position: relative;
}

.criterion-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
}

.criterion-risky {
    border-left-color: #dc3545;
    background: #f8d7da;
}

.criterion-risky:hover {
    border-left-color: #dc3545;
    background: #fdf2f2;
}

.criterion-safe {
    border-left-color: #28a745;
    background: #d4edda;
}

.criterion-safe:hover {
    border-left-color: #28a745;
    background: #f0fff4;
}

.criterion-number {
    display: inline-block;
    width: 24px;
    height: 24px;
    background: #667eea;
    color: white;
    border-radius: 50%;
    text-align: center;
    line-height: 24px;
    margin-right: 10px;
    font-size: 12px;
}

.criterion-title {
    font-weight: 600;
    margin-bottom: 8px;
}

.criterion-status {
    font-size: 14px;
    font-weight: 500;
}

.status-risky { color: #dc3545; }
.status-safe { color: #28a745; }

/* –ü–æ–ø–∞–ø —Å –¥–µ—Ç–∞–ª—è–º–∏ —Ä–∏—Å–∫–∞ */
.risk-details-popup {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.5);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 1000;
}

.risk-details-content {
    background: white;
    padding: 30px;
    border-radius: 12px;
    max-width: 800px;
    width: 90%;
    max-height: 80vh;
    overflow-y: auto;
    position: relative;
    box-shadow: 0 10px 30px rgba(0,0,0,0.3);
}

.close-risk-details {
    position: absolute;
    top: 15px;
    right: 15px;
    background: none;
    border: none;
    font-size: 24px;
    cursor: pointer;
    color: #666;
    width: 30px;
    height: 30px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.close-risk-details:hover {
    color: #000;
    background: #f8f9fa;
    border-radius: 50%;
}

.risk-recommendations {
    margin-top: 20px;
    padding-top: 20px;
    border-top: 2px solid #e9ecef;
}

.risk-recommendations h5 {
    color: #2c3e50;
    margin-bottom: 15px;
}

.recommendation-item {
    background: #f8f9fa;
    padding: 12px 15px;
    margin: 8px 0;
    border-radius: 6px;
    border-left: 4px solid #3498db;
}

.recommendation-item.warning {
    border-left-color: #e74c3c;
    background: #fdf2f2;
}

.recommendation-item.success {
    border-left-color: #27ae60;
    background: #f0fff4;
}

/* –°—Ç–∏–ª–∏ –¥–ª—è –¥–µ—Ç–∞–ª–µ–π —Ä–∞—Å—á–µ—Ç–∞ */
.calculation-details {
    background: #f8f9fa;
    padding: 15px;
    border-radius: 8px;
    margin: 10px 0;
    border-left: 4px solid #17a2b8;
}

.calculation-formula {
    font-family: 'Courier New', monospace;
    background: #2c3e50;
    color: #ecf0f1;
    padding: 10px;
    border-radius: 5px;
    margin: 10px 0;
    font-size: 14px;
}

.calculation-result {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 8px 12px;
    background: white;
    border-radius: 5px;
    margin: 5px 0;
}

.calculation-value {
    font-weight: bold;
}

.calculation-threshold {
    color: #666;
    font-size: 0.9em;
}

/* –î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ä–∏—Å–∫–∞—Ö */
.risk-details {
    background: #f8f9fa;
    padding: 20px;
    border-radius: 8px;
    margin: 20px 0;
}

.risk-summary {
    text-align: center;
    margin-bottom: 20px;
}

.risk-stats {
    display: flex;
    justify-content: space-around;
    flex-wrap: wrap;
    gap: 20px;
}

.stat-item {
    text-align: center;
}

.stat-value {
    font-size: 32px;
    font-weight: bold;
    display: block;
}

.stat-label {
    font-size: 14px;
    color: #666;
}

/* –û—Å—Ç–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ */
.indicators-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 15px;
    margin: 25px 0;
}

.indicator {
    padding: 15px;
    border-radius: 8px;
    text-align: center;
    font-weight: 500;
}

.indicator-active {
    background: #f8d7da;
    color: #721c24;
    border: 2px solid #f5c6cb;
}

.indicator-inactive {
    background: #d1edff;
    color: #155724;
    border: 2px solid #c3e6cb;
}

.metrics-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
    margin: 30px 0;
}

.metric-card {
    background: white;
    padding: 20px;
    border-radius: 8px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    border-left: 4px solid #667eea;
}

.metric-value {
    font-size: 24px;
    font-weight: bold;
    margin: 10px 0;
}

.metric-positive { color: #28a745; }
.metric-negative { color: #dc3545; }
.metric-neutral { color: #6c757d; }

.financial-table {
    width: 100%;
    border-collapse: collapse;
    margin: 25px 0;
    background: white;
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}

.financial-table th,
.financial-table td {
    padding: 12px 15px;
    text-align: left;
    border-bottom: 1px solid #e0e0e0;
}

.financial-table th {
    background: #f8f9fa;
    font-weight: 600;
}

.financial-table tr:hover {
    background: #f8f9fa;
}

.check-list {
    margin: 20px 0;
}

.check-item {
    display: flex;
    align-items: center;
    gap: 10px;
    margin: 10px 0;
    padding: 10px;
    border-radius: 6px;
}

.check-needed {
    background: #fff3cd;
    border-left: 4px solid #ffc107;
}

.check-not-needed {
    background: #d4edda;
    border-left: 4px solid #28a745;
}

.action-buttons {
    display: flex;
    gap: 15px;
    margin-top: 30px;
    flex-wrap: wrap;
}

.btn {
    padding: 12px 24px;
    border: none;
    border-radius: 6px;
    font-weight: 500;
    cursor: pointer;
    text-decoration: none;
    display: inline-block;
    text-align: center;
    transition: all 0.3s;
}

.btn-primary {
    background: #667eea;
    color: white;
}

.btn-secondary {
    background: #6c757d;
    color: white;
}

.btn-info {
    background: #17a2b8;
    color: white;
}

.btn-danger {
    background: #dc3545;
    color: white;
}

.btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.2);
}

@media (max-width: 768px) {
    .analysis-detail {
        padding: 10px;
    }
    
    .analysis-meta {
        flex-direction: column;
        gap: 10px;
    }
    
    .metrics-grid,
    .criteria-grid {
        grid-template-columns: 1fr;
    }
    
    .action-buttons {
        flex-direction: column;
    }
    
    .risk-details-content {
        padding: 20px;
        margin: 20px;
    }
}
</style>

<div class="analysis-detail">
    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∞–Ω–∞–ª–∏–∑–∞ -->
    <div class="analysis-header">
        <h1 class="analysis-title">{{ analysis.name }}</h1>
        <div class="analysis-meta">
            <div class="meta-item">
                <span>üìÖ –ü–µ—Ä–∏–æ–¥: {{ analysis.period_start_date }} - {{ analysis.period_end_date }}</span>
            </div>
            <div class="meta-item">
                <span>üïí –°–æ–∑–¥–∞–Ω: {{ analysis.creation_date|date:"d.m.Y H:i" }}</span>
            </div>
        </div>
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç -->
    <div class="text-center">
        <div class="risk-score {% if analysis.risk_score < 30 %}score-low{% elif analysis.risk_score < 60 %}score-medium{% else %}score-high{% endif %}">
            {{ analysis.risk_score }}/100
        </div>
        <div class="result-badge {% if analysis.is_positive_result %}result-positive{% elif analysis.risk_score < 60 %}result-warning{% else %}result-negative{% endif %}">
            {% if analysis.is_positive_result %}
                ‚úÖ –ù–∏–∑–∫–∏–π —Ä–∏—Å–∫ –ø—Ä–æ–≤–µ—Ä–∫–∏
            {% elif analysis.risk_score < 60 %}
                ‚ö†Ô∏è –°—Ä–µ–¥–Ω–∏–π —Ä–∏—Å–∫ –ø—Ä–æ–≤–µ—Ä–∫–∏  
            {% else %}
                üî¥ –í—ã—Å–æ–∫–∏–π —Ä–∏—Å–∫ –ø—Ä–æ–≤–µ—Ä–∫–∏
            {% endif %}
        </div>
    </div>

    <!-- –î–µ—Ç–∞–ª–∏ —Ä–∏—Å–∫–æ–≤ -->
    <div class="risk-details">
        <div class="risk-summary">
            <h3>–î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è —Ä–∏—Å–∫–æ–≤</h3>
        </div>
        <div class="risk-stats">
            <div class="stat-item">
                <span class="stat-value {% if analysis.risk_count > 5 %}metric-negative{% elif analysis.risk_count > 2 %}metric-neutral{% else %}metric-positive{% endif %}">
                    {{ analysis.risk_count|default:0 }}
                </span>
                <span class="stat-label">–∞–∫—Ç–∏–≤–Ω—ã—Ö —Ä–∏—Å–∫–æ–≤</span>
            </div>
            <div class="stat-item">
                <span class="stat-value">12</span>
                <span class="stat-label">–≤—Å–µ–≥–æ –∫—Ä–∏—Ç–µ—Ä–∏–µ–≤</span>
            </div>
            <div class="stat-item">
                <span class="stat-value {% if analysis.risk_score > 60 %}metric-negative{% elif analysis.risk_score > 30 %}metric-neutral{% else %}metric-positive{% endif %}">
                    {{ analysis.risk_score }}%
                </span>
                <span class="stat-label">–æ–±—â–∏–π —Ä–∏—Å–∫</span>
            </div>
        </div>
    </div>

    <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã —Ä–∏—Å–∫–∞ -->
    <h3>–ö–ª—é—á–µ–≤—ã–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã —Ä–∏—Å–∫–∞</h3>
    <div class="indicators-grid">
        <div class="indicator {% if analysis.prbm %}indicator-active{% else %}indicator-inactive{% endif %}">
            PRBM: {% if analysis.prbm %}üî¥ –£–±—ã—Ç–∫–∏{% else %}‚úÖ –ü—Ä–∏–±—ã–ª—å{% endif %}
        </div>
        <div class="indicator {% if analysis.optr %}indicator-active{% else %}indicator-inactive{% endif %}">
            OPTR: {% if analysis.optr %}üî¥ –†–æ—Å—Ç —Ä–∞—Å—Ö–æ–¥–æ–≤{% else %}‚úÖ –ù–æ—Ä–º–∞{% endif %}
        </div>
        <div class="indicator {% if analysis.ndss %}indicator-active{% else %}indicator-inactive{% endif %}">
            NDSS: {% if analysis.ndss %}üî¥ –ù–∞–ª–æ–≥–æ–≤—ã–µ —Ä–∏—Å–∫–∏{% else %}‚úÖ –ù–æ—Ä–º–∞{% endif %}
        </div>
        <div class="indicator {% if analysis.retab %}indicator-active{% else %}indicator-inactive{% endif %}">
            RETAB: {% if analysis.retab %}üî¥ –†–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—å{% else %}‚úÖ –ù–æ—Ä–º–∞{% endif %}
        </div>
    </div>

    <!-- –ö—Ä–∏—Ç–µ—Ä–∏–∏ –§–ù–° -->
    <div class="criteria-section">
        <h3>–ö—Ä–∏—Ç–µ—Ä–∏–∏ —Ä–∏—Å–∫–∞ –ø–æ –º–µ—Ç–æ–¥–∏–∫–µ –§–ù–° (12 –∫—Ä–∏—Ç–µ—Ä–∏–µ–≤)</h3>
        <div class="criteria-grid" id="criteria-container">
            <!-- –ö—Ä–∏—Ç–µ—Ä–∏–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ JavaScript -->
        </div>
    </div>

    <!-- –î–µ—Ç–∞–ª–∏ —Ä–∏—Å–∫–∞ (–ø–æ—è–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ –∫–ª–∏–∫–µ) -->
    <div id="risk-details" class="risk-details-popup" style="display: none;">
        <div class="risk-details-content">
            <button class="close-risk-details" onclick="closeRiskDetails()">√ó</button>
            <h4 id="risk-title">–î–µ—Ç–∞–ª–∏ —Ä–∏—Å–∫–∞</h4>
            <div id="risk-description">
                <!-- –°—é–¥–∞ –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è –æ–ø–∏—Å–∞–Ω–∏–µ —Ä–∏—Å–∫–∞ -->
            </div>
            <div class="risk-recommendations">
                <h5>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –º–∏–Ω–∏–º–∏–∑–∞—Ü–∏–∏:</h5>
                <div id="risk-recommendations-list">
                    <!-- –°—é–¥–∞ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ -->
                </div>
            </div>
        </div>
    </div>

    <!-- –î–µ—Ç–∞–ª–∏ —Ä–∞—Å—á–µ—Ç–∞ (–ø–æ—è–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –Ω–∞ –∫–Ω–æ–ø–∫—É) -->
    <div id="calculation-details" class="risk-details-popup" style="display: none;">
        <div class="risk-details-content">
            <button class="close-risk-details" onclick="closeCalculationDetails()">√ó</button>
            <h4>üìä –î–µ—Ç–∞–ª–∏ —Ä–∞—Å—á–µ—Ç–∞ –ø–æ –º–µ—Ç–æ–¥–∏–∫–µ –§–ù–°</h4>
            <div id="calculation-content">
                <!-- –°—é–¥–∞ –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ä–∞—Å—á–µ—Ç–∞—Ö -->
            </div>
        </div>
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ -->
    <h3>–ö–ª—é—á–µ–≤—ã–µ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏</h3>
    <div class="metrics-grid">
        <div class="metric-card">
            <h4>–†–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—å –ø—Ä–æ–¥–∞–∂</h4>
            <div class="metric-value {% if analysis.profitability_ratio_end > 9.6 %}metric-positive{% elif analysis.profitability_ratio_end > 5 %}metric-neutral{% else %}metric-negative{% endif %}">
                {{ analysis.profitability_ratio_end|default:"0" }}%
            </div>
            <small>–ù–æ—Ä–º–∞: >9.6%</small>
        </div>
        
        <div class="metric-card">
            <h4>–ù–∞–ª–æ–≥–æ–≤–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞</h4>
            <div class="metric-value {% if analysis.tax_burden > 8.0 %}metric-positive{% else %}metric-negative{% endif %}">
                {{ analysis.tax_burden|default:"0" }}%
            </div>
            <small>–ù–æ—Ä–º–∞: >8.0%</small>
        </div>
        
        <div class="metric-card">
            <h4>–í—ã—á–µ—Ç—ã –ø–æ –ù–î–°</h4>
            <div class="metric-value {% if analysis.vat_deduction_ratio < 89 %}metric-positive{% else %}metric-negative{% endif %}">
                {{ analysis.vat_deduction_ratio|default:"0" }}%
            </div>
            <small>–†–∏—Å–∫: >89%</small>
        </div>
        
        <div class="metric-card">
            <h4>–°—Ä–µ–¥–Ω—è—è –∑–∞—Ä–ø–ª–∞—Ç–∞</h4>
            <div class="metric-value {% if analysis.avg_salary > 43000 %}metric-positive{% else %}metric-negative{% endif %}">
                {{ analysis.avg_salary|default:"0"|floatformat:0 }} ‚ÇΩ
            </div>
            <small>–ù–æ—Ä–º–∞: >43,000‚ÇΩ</small>
        </div>
    </div>

    <!-- –§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ -->
    <h3>–§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏</h3>
    <table class="financial-table">
        <thead>
            <tr>
                <th>–ü–æ–∫–∞–∑–∞—Ç–µ–ª—å</th>
                <th>–ù–∞—á–∞–ª–æ –ø–µ—Ä–∏–æ–¥–∞</th>
                <th>–ö–æ–Ω–µ—Ü –ø–µ—Ä–∏–æ–¥–∞</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>–í—ã—Ä—É—á–∫–∞ –±–∞–∑–æ–≤–æ–≥–æ –ø–µ—Ä–∏–æ–¥–∞</td>
                <td>{{ analysis.revenue_base_start|floatformat:2 }}</td>
                <td>{{ analysis.revenue_base_end|floatformat:2 }}</td>
            </tr>
            <tr>
                <td>–ü—Ä–∏–±—ã–ª—å –æ—Ç –ø—Ä–æ–¥–∞–∂</td>
                <td>{{ analysis.profit_sales_start|floatformat:2 }}</td>
                <td>{{ analysis.profit_sales_end|floatformat:2 }}</td>
            </tr>
            <tr>
                <td>–°–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å –ø—Ä–æ–¥–∞–∂</td>
                <td>{{ analysis.cost_sales_base_start|floatformat:2 }}</td>
                <td>{{ analysis.cost_sales_base_end|floatformat:2 }}</td>
            </tr>
            <tr>
                <td>–ö–æ–º–º–µ—Ä—á–µ—Å–∫–∏–µ —Ä–∞—Å—Ö–æ–¥—ã</td>
                <td>{{ analysis.commercial_expenses_start|floatformat:2 }}</td>
                <td>{{ analysis.commercial_expenses_end|floatformat:2 }}</td>
            </tr>
            <tr>
                <td>–ß–∏—Å–ª–µ–Ω–Ω–æ—Å—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤</td>
                <td>{{ analysis.employee_count_start }}</td>
                <td>{{ analysis.employee_count_end }}</td>
            </tr>
        </tbody>
    </table>

    <!-- –ù–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ -->
    <h3>–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏</h3>
    <div class="check-list">
        <div class="check-item {% if analysis.finance_check %}check-needed{% else %}check-not-needed{% endif %}">
            {% if analysis.finance_check %}‚ö†Ô∏è{% else %}‚úÖ{% endif %}
            –§–∏–Ω–∞–Ω—Å–æ–≤–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞: {% if analysis.finance_check %}–¢—Ä–µ–±—É–µ—Ç—Å—è{% else %}–ù–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è{% endif %}
        </div>
        
        <div class="check-item {% if analysis.explanation_needed %}check-needed{% else %}check-not-needed{% endif %}">
            {% if analysis.explanation_needed %}‚ö†Ô∏è{% else %}‚úÖ{% endif %}
            –ü–æ—è—Å–Ω–µ–Ω–∏—è: {% if analysis.explanation_needed %}–¢—Ä–µ–±—É—é—Ç—Å—è{% else %}–ù–µ —Ç—Ä–µ–±—É—é—Ç—Å—è{% endif %}
        </div>
        
        <div class="check-item {% if analysis.accounting_check %}check-needed{% else %}check-not-needed{% endif %}">
            {% if analysis.accounting_check %}‚ö†Ô∏è{% else %}‚úÖ{% endif %}
            –ë—É—Ö–≥–∞–ª—Ç–µ—Ä—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞: {% if analysis.accounting_check %}–¢—Ä–µ–±—É–µ—Ç—Å—è{% else %}–ù–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è{% endif %}
        </div>
    </div>

    <!-- –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π -->
    <div class="action-buttons">
        <a href="{% url 'profile' %}" class="btn btn-secondary">
            üìã –ö —Å–ø–∏—Å–∫—É –∞–Ω–∞–ª–∏–∑–æ–≤
        </a>
        <button onclick="showCalculationDetails()" class="btn btn-info">
            üìä –ü–æ–¥—Ä–æ–±–Ω–µ–µ –æ —Ä–∞—Å—á–µ—Ç–∞—Ö
        </button>
        <button onclick="deleteAnalysis({{ analysis.id }})" class="btn btn-danger">
            üóëÔ∏è –£–¥–∞–ª–∏—Ç—å –∞–Ω–∞–ª–∏–∑
        </button>
        <button onclick="window.print()" class="btn btn-secondary">
            üñ®Ô∏è –ü–µ—á–∞—Ç—å –æ—Ç—á–µ—Ç–∞
        </button>
    </div>
</div>

<!-- –°–∫—Ä—ã—Ç—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è JavaScript -->
<div id="analysis-data" 
     data-tax-burden="{{ analysis.tax_burden|default:0 }}"
     data-prbm="{{ analysis.prbm|yesno:'true,false' }}"
     data-vat-deduction="{{ analysis.vat_deduction_ratio|default:0 }}"
     data-optr="{{ analysis.optr|yesno:'true,false' }}"
     data-avg-salary="{{ analysis.avg_salary|default:0 }}"
     data-profitability-end="{{ analysis.profitability_ratio_end|default:0 }}"
     data-profitability-assets="{{ analysis.profitability_assets|default:0 }}"
     data-doubtful-counterparties="{{ analysis.doubtful_counterparties|yesno:'true,false' }}"
     data-no-explanation="{{ analysis.no_explanation_notification|yesno:'true,false' }}"
     data-location-change="{{ analysis.frequent_location_change|yesno:'true,false' }}"
     data-risk-count="{{ analysis.risk_count|default:0 }}"
     data-risk-score="{{ analysis.risk_score|default:0 }}"
     data-analysis-id="{{ analysis.id }}"
     data-csrf-token="{{ csrf_token }}"
     data-profile-url="{% url 'profile' %}"
     style="display: none;">
</div>

<script>
// –ü–æ–ª–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –æ –≤—Å–µ—Ö 12 –∫—Ä–∏—Ç–µ—Ä–∏—è—Ö –§–ù–°
const riskData = {
    1: {
        title: "–ù–∏–∑–∫–∞—è –Ω–∞–ª–æ–≥–æ–≤–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞",
        description: "–ù–∞–ª–æ–≥–æ–≤–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∏–∂–µ —Å—Ä–µ–¥–Ω–µ–æ—Ç—Ä–∞—Å–ª–µ–≤–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è (8%). –§–ù–° –æ–±—Ä–∞—â–∞–µ—Ç –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ –∫–æ–º–ø–∞–Ω–∏–∏ —Å –Ω–∞–≥—Ä—É–∑–∫–æ–π –º–µ–Ω–µ–µ 8% –æ—Ç –≤—ã—Ä—É—á–∫–∏.",
        recommendations: [
            "–ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –æ–¥–∏–Ω –∏–∑ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ä–µ–∂–∏–º–æ–≤ –Ω–∞–ª–æ–≥–æ–æ–±–ª–æ–∂–µ–Ω–∏—è",
            "–ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞—Ç—Ä–∞—Ç –∏ —Ä–∞—Å—Ö–æ–¥–æ–≤",
            "–ü–µ—Ä–µ–¥–∞—á–∞ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π –Ω–∞ –∞—É—Ç—Å–æ—Ä—Å–∏–Ω–≥",
            "–ê–Ω–∞–ª–∏–∑ –Ω–∞–ª–æ–≥–æ–≤–æ–π –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏"
        ]
    },
    2: {
        title: "–ù–∞–ª–∏—á–∏–µ —É–±—ã—Ç–∫–æ–≤",
        description: "–ö–æ–º–ø–∞–Ω–∏—è –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —É–±—ã—Ç–∫–∏ –≤ —Ç–µ—á–µ–Ω–∏–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –æ—Ç—á–µ—Ç–Ω—ã—Ö –ø–µ—Ä–∏–æ–¥–æ–≤. –≠—Ç–æ –º–æ–∂–µ—Ç –≤—ã–∑–≤–∞—Ç—å –≤–æ–ø—Ä–æ—Å—ã —É –Ω–∞–ª–æ–≥–æ–≤—ã—Ö –æ—Ä–≥–∞–Ω–æ–≤ –æ —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏ —Ö–æ–∑—è–π—Å—Ç–≤–µ–Ω–Ω–æ–π –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏.",
        recommendations: [
            "–ü–æ–ª–Ω–æ–µ –æ—Ç—Ä–∞–∂–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∫–æ–º–º–µ—Ä—á–µ—Å–∫–æ–π –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏",
            "–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–æ–±–æ—Ä–æ—Ç–∞",
            "–°–æ–∑–¥–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞",
            "–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –∞–Ω—Ç–∏–∫—Ä–∏–∑–∏—Å–Ω–æ–≥–æ –ø–ª–∞–Ω–∞"
        ]
    },
    3: {
        title: "–í—ã—Å–æ–∫–∏–µ –≤—ã—á–µ—Ç—ã –ø–æ –ù–î–°",
        description: "–î–æ–ª—è –Ω–∞–ª–æ–≥–æ–≤—ã—Ö –≤—ã—á–µ—Ç–æ–≤ –ø–æ –ù–î–° –ø—Ä–µ–≤—ã—à–∞–µ—Ç 89% –æ—Ç –Ω–∞—á–∏—Å–ª–µ–Ω–Ω–æ–≥–æ –Ω–∞–ª–æ–≥–∞. –≠—Ç–æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∫–∞–∑–∞—Ç–µ–ª—å –¥–ª—è –§–ù–°, —É–∫–∞–∑—ã–≤–∞—é—â–∏–π –Ω–∞ –≤–æ–∑–º–æ–∂–Ω—ã–µ —Å—Ö–µ–º—ã –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏.",
        recommendations: [
            "–°–æ–∑–¥–∞–Ω–∏–µ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π —Å–∏—Å—Ç–µ–º—ã –ø—Ä–æ—Ñ–∏–ª–∞–∫—Ç–∏–∫–∏ –Ω–∞–ª–æ–≥–æ–≤—ã—Ö –≤—ã—á–µ—Ç–æ–≤",
            "–¢—â–∞—Ç–µ–ª—å–Ω–æ–µ —Å–æ–±–ª—é–¥–µ–Ω–∏–µ –Ω–∞–ª–æ–≥–æ–≤–æ–≥–æ –∑–∞–∫–æ–Ω–æ–¥–∞—Ç–µ–ª—å—Å—Ç–≤–∞",
            "–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç–æ–≤ –Ω–∞ –¥–æ–±—Ä–æ—Å–æ–≤–µ—Å—Ç–Ω–æ—Å—Ç—å",
            "–î–æ–∫—É–º–µ–Ω—Ç–∞–ª—å–Ω–æ–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π"
        ]
    },
    4: {
        title: "–†–æ—Å—Ç —Ä–∞—Å—Ö–æ–¥–æ–≤ > —Ä–æ—Å—Ç –¥–æ—Ö–æ–¥–æ–≤",
        description: "–¢–µ–º–ø—ã —Ä–æ—Å—Ç–∞ —Ä–∞—Å—Ö–æ–¥–æ–≤ –æ–ø–µ—Ä–µ–∂–∞—é—Ç —Ç–µ–º–ø—ã —Ä–æ—Å—Ç–∞ –¥–æ—Ö–æ–¥–æ–≤. –ú–æ–∂–µ—Ç —É–∫–∞–∑—ã–≤–∞—Ç—å –Ω–∞ –Ω–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞—Ç—Ä–∞—Ç–∞–º–∏ –∏–ª–∏ –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω–æ–µ –∑–∞–≤—ã—à–µ–Ω–∏–µ —Ä–∞—Å—Ö–æ–¥–æ–≤.",
        recommendations: [
            "–†–µ–≥—É–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–∑–¥–µ—Ä–∂–µ–∫ –∏ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ–Ω–Ω–æ–π –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏",
            "–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —É—á–µ—Ç–∞ —Ä–∞–±–æ—á–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏",
            "–ü–æ–≤—ã—à–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è –∫–≤–∞–ª–∏—Ñ–∏–∫–∞—Ü–∏–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤",
            "–í–Ω–µ–¥—Ä–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã –∫–æ–Ω—Ç—Ä–æ–ª—è –∑–∞—Ç—Ä–∞—Ç"
        ]
    },
    5: {
        title: "–ù–∏–∑–∫–∞—è —Å—Ä–µ–¥–Ω—è—è –∑–∞—Ä–ø–ª–∞—Ç–∞",
        description: "–°—Ä–µ–¥–Ω—è—è –∑–∞—Ä–∞–±–æ—Ç–Ω–∞—è –ø–ª–∞—Ç–∞ –Ω–∏–∂–µ —Å—Ä–µ–¥–Ω–µ–æ—Ç—Ä–∞—Å–ª–µ–≤–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è (43,000 —Ä—É–±.). –ú–æ–∂–µ—Ç —Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å—Å—è –∫–∞–∫ –ø—Ä–∏–∑–Ω–∞–∫ —Å–µ—Ä—ã—Ö —Å—Ö–µ–º –æ–ø–ª–∞—Ç—ã —Ç—Ä—É–¥–∞.",
        recommendations: [
            "–ü—Ä–∏–≤–µ–¥–µ–Ω–∏–µ –∑–∞—Ä–ø–ª–∞—Ç –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Å –æ—Ç—Ä–∞—Å–ª–µ–≤—ã–º–∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞–º–∏",
            "–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã –æ–ø–ª–∞—Ç—ã —Ç—Ä—É–¥–∞",
            "–ü–æ–≤—ã—à–µ–Ω–∏–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –ø–µ—Ä—Å–æ–Ω–∞–ª–∞",
            "–í–Ω–µ–¥—Ä–µ–Ω–∏–µ KPI –∏ —Å–∏—Å—Ç–µ–º—ã –º–æ—Ç–∏–≤–∞—Ü–∏–∏"
        ]
    },
    6: {
        title: "–ù–∏–∑–∫–∞—è —Ä–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—å –ø—Ä–æ–¥–∞–∂",
        description: "–†–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—å –ø—Ä–æ–¥–∞–∂ –Ω–∏–∂–µ —Å—Ä–µ–¥–Ω–µ–æ—Ç—Ä–∞—Å–ª–µ–≤–æ–≥–æ –ø–æ–∫–∞–∑–∞—Ç–µ–ª—è (9.6%). –£–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –Ω–∏–∑–∫—É—é —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –±–∏–∑–Ω–µ—Å–∞ –∏–ª–∏ –≤–æ–∑–º–æ–∂–Ω–æ–µ –∑–∞–Ω–∏–∂–µ–Ω–∏–µ –¥–æ—Ö–æ–¥–æ–≤.",
        recommendations: [
            "–†–µ–≥—É–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è —É—Ä–æ–≤–Ω—è —Ä–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç–∏",
            "–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ü–µ–Ω–æ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è",
            "–°–Ω–∏–∂–µ–Ω–∏–µ —Å–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç–∏ –ø—Ä–æ–¥—É–∫—Ü–∏–∏",
            "–£–≤–µ–ª–∏—á–µ–Ω–∏–µ –º–∞—Ä–∫–µ—Ç–∏–Ω–≥–æ–≤–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏"
        ]
    },
    7: {
        title: "–ù–∏–∑–∫–∞—è —Ä–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—å –∞–∫—Ç–∏–≤–æ–≤",
        description: "–†–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—å –∞–∫—Ç–∏–≤–æ–≤ –Ω–∏–∂–µ –Ω–æ—Ä–º–∞—Ç–∏–≤–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π (5.4%). –°–≤–∏–¥–µ—Ç–µ–ª—å—Å—Ç–≤—É–µ—Ç –æ –Ω–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ —Ä–µ—Å—É—Ä—Å–æ–≤ –∫–æ–º–ø–∞–Ω–∏–∏.",
        recommendations: [
            "–§–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –≤–Ω—É—Ç—Ä–∏ –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏—è",
            "–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∞–∫—Ç–∏–≤–æ–≤",
            "–ü–æ–≤—ã—à–µ–Ω–∏–µ –æ–±–æ—Ä–∞—á–∏–≤–∞–µ–º–æ—Å—Ç–∏ –∞–∫—Ç–∏–≤–æ–≤",
            "–í–Ω–µ–¥—Ä–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å—é"
        ]
    },
    8: {
        title: "–°–æ–º–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç—ã",
        description: "–ù–∞–ª–∏—á–∏–µ –≤ –æ—Ç—á–µ—Ç–Ω–æ—Å—Ç–∏ –æ–ø–µ—Ä–∞—Ü–∏–π —Å –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç–∞–º–∏, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –≤—ã–∑—ã–≤–∞—Ç—å –≤–æ–ø—Ä–æ—Å—ã —É –§–ù–° (–æ–¥–Ω–æ–¥–Ω–µ–≤–∫–∏, –∫–æ–º–ø–∞–Ω–∏–∏ —Å –ø—Ä–∏–∑–Ω–∞–∫–∞–º–∏ –Ω–µ–¥–æ–±—Ä–æ—Å–æ–≤–µ—Å—Ç–Ω–æ—Å—Ç–∏).",
        recommendations: [
            "–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç–æ–≤ –Ω–∞ –¥–æ–±—Ä–æ—Å–æ–≤–µ—Å—Ç–Ω–æ—Å—Ç—å –ø–µ—Ä–µ–¥ –∑–∞–∫–ª—é—á–µ–Ω–∏–µ–º —Å–¥–µ–ª–æ–∫",
            "–ù–∞–ª–∏—á–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞–ª—å–Ω–æ–≥–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –ø–æ–ª–Ω–æ–º–æ—á–∏–π —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—è",
            "–ù–∞–ª–∏—á–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–º –º–µ—Å—Ç–æ–Ω–∞—Ö–æ–∂–¥–µ–Ω–∏–∏ –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç–æ–≤",
            "–í–µ–¥–µ–Ω–∏–µ –¥–æ—Å—å–µ –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç–æ–≤"
        ]
    },
    9: {
        title: "–ù–µ–ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –ø–æ—è—Å–Ω–µ–Ω–∏–π",
        description: "–ö–æ–º–ø–∞–Ω–∏—è –Ω–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –ø–æ—è—Å–Ω–µ–Ω–∏—è –ø–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º –Ω–∞–ª–æ–≥–æ–≤—ã—Ö –æ—Ä–≥–∞–Ω–æ–≤ –∏–ª–∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –∏—Ö –Ω–µ—Å–≤–æ–µ–≤—Ä–µ–º–µ–Ω–Ω–æ.",
        recommendations: [
            "–°–≤–æ–µ–≤—Ä–µ–º–µ–Ω–Ω–æ–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –ø–æ—è—Å–Ω–µ–Ω–∏–π –Ω–∞ –∑–∞–ø—Ä–æ—Å—ã –§–ù–°",
            "–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –ø–æ–ª–Ω–æ–≥–æ –ø–∞–∫–µ—Ç–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤",
            "–í–µ–¥–µ–Ω–∏–µ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–∏–≤–Ω–æ–π –ø–µ—Ä–µ–ø–∏—Å–∫–∏ —Å –Ω–∞–ª–æ–≥–æ–≤—ã–º–∏ –æ—Ä–≥–∞–Ω–∞–º–∏",
            "–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –∑–∞ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å –§–ù–°"
        ]
    },
    10: {
        title: "–ß–∞—Å—Ç–∞—è —Å–º–µ–Ω–∞ –º–µ—Å—Ç–æ–Ω–∞—Ö–æ–∂–¥–µ–Ω–∏—è",
        description: "–ö–æ–º–ø–∞–Ω–∏—è —á–∞—Å—Ç–æ –º–µ–Ω—è–µ—Ç —é—Ä–∏–¥–∏—á–µ—Å–∫–∏–π –∞–¥—Ä–µ—Å, —á—Ç–æ –º–æ–∂–µ—Ç —Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å—Å—è –∫–∞–∫ –ø–æ–ø—ã—Ç–∫–∞ —É—Ö–æ–¥–∞ –æ—Ç –Ω–∞–ª–æ–≥–æ–≤–æ–≥–æ –∫–æ–Ω—Ç—Ä–æ–ª—è.",
        recommendations: [
            "–°—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏—è —é—Ä–∏–¥–∏—á–µ—Å–∫–æ–≥–æ –∞–¥—Ä–µ—Å–∞",
            "–°–≤–æ–µ–≤—Ä–µ–º–µ–Ω–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –Ω–∞–ª–æ–≥–æ–≤–æ–≥–æ –æ—Ä–≥–∞–Ω–∞ –æ —Å–º–µ–Ω–µ –º–µ—Å—Ç–æ–Ω–∞—Ö–æ–∂–¥–µ–Ω–∏—è",
            "–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –æ–±–æ—Å–Ω–æ–≤–∞–Ω–∏—è —Å–º–µ–Ω—ã –∞–¥—Ä–µ—Å–∞",
            "–ú–∏–Ω–∏–º–∏–∑–∞—Ü–∏—è –º–∏–≥—Ä–∞—Ü–∏–∏ –º–µ–∂–¥—É —Ä–µ–≥–∏–æ–Ω–∞–º–∏"
        ]
    },
    11: {
        title: "–ù–µ–æ–¥–Ω–æ–∫—Ä–∞—Ç–Ω–∞—è —Å–Ω—è—Ç–∏–µ/–ø–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–∞ —É—á–µ—Ç",
        description: "–ö–æ–º–ø–∞–Ω–∏—è –Ω–µ–æ–¥–Ω–æ–∫—Ä–∞—Ç–Ω–æ —Å–Ω–∏–º–∞–µ—Ç—Å—è –∏ —Å—Ç–∞–≤–∏—Ç—Å—è –Ω–∞ —É—á–µ—Ç –≤ –Ω–∞–ª–æ–≥–æ–≤—ã—Ö –æ—Ä–≥–∞–Ω–∞—Ö, —á—Ç–æ —è–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏–∑–Ω–∞–∫–æ–º –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏.",
        recommendations: [
            "–°—Ç–∞–±–∏–ª—å–Ω–æ–µ –≤–µ–¥–µ–Ω–∏–µ –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏",
            "–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∞—â–∏—Ö —Å–≤–µ–¥–µ–Ω–∏–π –≤ —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ö",
            "–ú–∏–Ω–∏–º–∏–∑–∞—Ü–∏—è –æ—à–∏–±–æ–∫ –≤ –Ω–∞–ª–æ–≥–æ–≤—ã—Ö –æ—Ç—á–µ—Ç–∞—Ö",
            "–°–æ–±–ª—é–¥–µ–Ω–∏–µ —Å—Ä–æ–∫–æ–≤ –ø–æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –Ω–∞ —É—á–µ—Ç"
        ]
    },
    12: {
        title: "–ó–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ —Ä–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç–∏",
        description: "–ó–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è —Ä–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç–∏ –æ—Ç —Å—Ä–µ–¥–Ω–µ–æ—Ç—Ä–∞—Å–ª–µ–≤—ã—Ö –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π (–±–æ–ª–µ–µ 10% –≤ –º–µ–Ω—å—à—É—é —Å—Ç–æ—Ä–æ–Ω—É).",
        recommendations: [
            "–†–µ–≥—É–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è —É—Ä–æ–≤–Ω—è —Ä–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç–∏",
            "–ü—Ä–æ–≤–µ–¥–µ–Ω–∏–µ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ —Ñ–∏–Ω–∞–Ω—Å–æ–≤–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞",
            "–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –æ—Ç—Ä–∞—Å–ª–µ–≤—ã–º–∏ benchmarks",
            "–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –±–∏–∑–Ω–µ—Å-–ø—Ä–æ—Ü–µ—Å—Å–æ–≤"
        ]
    }
};

// –§—É–Ω–∫—Ü–∏—è –ø–æ–∫–∞–∑–∞ –¥–µ—Ç–∞–ª–µ–π —Ä–∏—Å–∫–∞
function showRiskDetails(riskId) {
    const risk = riskData[riskId];
    if (!risk) return;

    const dataElement = document.getElementById('analysis-data');
    const isRisky = getCriterionStatus(riskId);
    
    document.getElementById('risk-title').textContent = risk.title;
    document.getElementById('risk-description').innerHTML = `
        <p><strong>–û–ø–∏—Å–∞–Ω–∏–µ:</strong> ${risk.description}</p>
        <p><strong>–°—Ç–∞—Ç—É—Å:</strong> <span class="${isRisky ? 'status-risky' : 'status-safe'}">${isRisky ? 'üî¥ –û–±–Ω–∞—Ä—É–∂–µ–Ω —Ä–∏—Å–∫' : '‚úÖ –†–∏—Å–∫ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç'}</span></p>
    `;

    const recommendationsList = document.getElementById('risk-recommendations-list');
    recommendationsList.innerHTML = risk.recommendations.map(rec => 
        `<div class="recommendation-item ${isRisky ? 'warning' : 'success'}">${rec}</div>`
    ).join('');

    document.getElementById('risk-details').style.display = 'flex';
}

// –§—É–Ω–∫—Ü–∏—è –∑–∞–∫—Ä—ã—Ç–∏—è –ø–æ–ø–∞–ø–∞
function closeRiskDetails() {
    document.getElementById('risk-details').style.display = 'none';
}

// –§—É–Ω–∫—Ü–∏—è –ø–æ–∫–∞–∑–∞ –¥–µ—Ç–∞–ª–µ–π —Ä–∞—Å—á–µ—Ç–∞
function showCalculationDetails() {
    const dataElement = document.getElementById('analysis-data');
    
    const calculations = `
        <div class="calculation-details">
            <h5>1. –ù–∏–∑–∫–∞—è –Ω–∞–ª–æ–≥–æ–≤–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞</h5>
            <div class="calculation-formula">
                –ù–∞–ª–æ–≥–æ–≤–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ = (–°—É–º–º–∞ —É–ø–ª–∞—á–µ–Ω–Ω—ã—Ö –Ω–∞–ª–æ–≥–æ–≤ / –í—ã—Ä—É—á–∫–∞) √ó 100%
            </div>
            <div class="calculation-result">
                <span>–†–µ–∑—É–ª—å—Ç–∞—Ç: ${parseFloat(dataElement.dataset.taxBurden).toFixed(2)}%</span>
                <span class="calculation-threshold">–ü–æ—Ä–æ–≥: < 8.0%</span>
            </div>
            <div class="calculation-result">
                <span class="calculation-value ${parseFloat(dataElement.dataset.taxBurden) < 8.0 ? 'status-risky' : 'status-safe'}">
                    ${parseFloat(dataElement.dataset.taxBurden) < 8.0 ? 'üî¥ –†–ò–°–ö' : '‚úÖ –ë–ï–ó –†–ò–°–ö–ê'}
                </span>
            </div>
        </div>

        <div class="calculation-details">
            <h5>2. –ù–∞–ª–∏—á–∏–µ —É–±—ã—Ç–∫–æ–≤</h5>
            <div class="calculation-formula">
                –£–±—ã—Ç–∫–∏ –≤ –Ω–∞—á–∞–ª–µ –ø–µ—Ä–∏–æ–¥–∞: ${parseFloat(dataElement.dataset.profitSalesStart).toFixed(2)} —Ä—É–±.<br>
                –£–±—ã—Ç–∫–∏ –≤ –∫–æ–Ω—Ü–µ –ø–µ—Ä–∏–æ–¥–∞: ${parseFloat(dataElement.dataset.profitSalesEnd).toFixed(2)} —Ä—É–±.
            </div>
            <div class="calculation-result">
                <span class="calculation-value ${dataElement.dataset.prbm === 'true' ? 'status-risky' : 'status-safe'}">
                    ${dataElement.dataset.prbm === 'true' ? 'üî¥ –†–ò–°–ö (—É–±—ã—Ç–∫–∏ –≤ –æ–±–æ–∏—Ö –ø–µ—Ä–∏–æ–¥–∞—Ö)' : '‚úÖ –ë–ï–ó –†–ò–°–ö–ê'}
                </span>
            </div>
        </div>

        <div class="calculation-details">
            <h5>3. –í—ã—Å–æ–∫–∏–µ –≤—ã—á–µ—Ç—ã –ø–æ –ù–î–°</h5>
            <div class="calculation-formula">
                –î–æ–ª—è –≤—ã—á–µ—Ç–æ–≤ = (–ù–î–° –∫ –≤—ã—á–µ—Ç—É / –ù–∞—á–∏—Å–ª–µ–Ω–Ω—ã–π –ù–î–°) √ó 100%
            </div>
            <div class="calculation-result">
                <span>–†–µ–∑—É–ª—å—Ç–∞—Ç: ${parseFloat(dataElement.dataset.vatDeduction).toFixed(2)}%</span>
                <span class="calculation-threshold">–ü–æ—Ä–æ–≥: ‚â• 89%</span>
            </div>
            <div class="calculation-result">
                <span class="calculation-value ${parseFloat(dataElement.dataset.vatDeduction) >= 89 ? 'status-risky' : 'status-safe'}">
                    ${parseFloat(dataElement.dataset.vatDeduction) >= 89 ? 'üî¥ –†–ò–°–ö' : '‚úÖ –ë–ï–ó –†–ò–°–ö–ê'}
                </span>
            </div>
        </div>

        <div class="calculation-details">
            <h5>4. –†–æ—Å—Ç —Ä–∞—Å—Ö–æ–¥–æ–≤ > —Ä–æ—Å—Ç –¥–æ—Ö–æ–¥–æ–≤</h5>
            <div class="calculation-formula">
                –†–æ—Å—Ç –≤—ã—Ä—É—á–∫–∏: ${calculateRevenueGrowth().toFixed(2)}%<br>
                –†–æ—Å—Ç —Ä–∞—Å—Ö–æ–¥–æ–≤: ${calculateCostGrowth().toFixed(2)}%
            </div>
            <div class="calculation-result">
                <span class="calculation-value ${dataElement.dataset.optr === 'true' ? 'status-risky' : 'status-safe'}">
                    ${dataElement.dataset.optr === 'true' ? 'üî¥ –†–ò–°–ö (—Ä–∞—Å—Ö–æ–¥—ã —Ä–∞—Å—Ç—É—Ç –±—ã—Å—Ç—Ä–µ–µ)' : '‚úÖ –ë–ï–ó –†–ò–°–ö–ê'}
                </span>
            </div>
        </div>

        <div class="calculation-details">
            <h5>5. –ù–∏–∑–∫–∞—è —Å—Ä–µ–¥–Ω—è—è –∑–∞—Ä–ø–ª–∞—Ç–∞</h5>
            <div class="calculation-formula">
                –°—Ä–µ–¥–Ω—è—è –∑–∞—Ä–ø–ª–∞—Ç–∞ = (–§–æ–Ω–¥ –æ–ø–ª–∞—Ç—ã —Ç—Ä—É–¥–∞ / –ß–∏—Å–ª–µ–Ω–Ω–æ—Å—Ç—å) / 12 –º–µ—Å—è—Ü–µ–≤
            </div>
            <div class="calculation-result">
                <span>–†–µ–∑—É–ª—å—Ç–∞—Ç: ${parseFloat(dataElement.dataset.avgSalary).toFixed(0)} —Ä—É–±.</span>
                <span class="calculation-threshold">–ü–æ—Ä–æ–≥: < 43,000 —Ä—É–±.</span>
            </div>
            <div class="calculation-result">
                <span class="calculation-value ${parseFloat(dataElement.dataset.avgSalary) < 43000 ? 'status-risky' : 'status-safe'}">
                    ${parseFloat(dataElement.dataset.avgSalary) < 43000 ? 'üî¥ –†–ò–°–ö' : '‚úÖ –ë–ï–ó –†–ò–°–ö–ê'}
                </span>
            </div>
        </div>

        <div class="calculation-details">
            <h5>6. –ù–∏–∑–∫–∞—è —Ä–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—å –ø—Ä–æ–¥–∞–∂</h5>
            <div class="calculation-formula">
                –†–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—å –ø—Ä–æ–¥–∞–∂ = ((–í—ã—Ä—É—á–∫–∞ - –ó–∞—Ç—Ä–∞—Ç—ã) / –í—ã—Ä—É—á–∫–∞) √ó 100%
            </div>
            <div class="calculation-result">
                <span>–†–µ–∑—É–ª—å—Ç–∞—Ç: ${parseFloat(dataElement.dataset.profitabilityEnd).toFixed(2)}%</span>
                <span class="calculation-threshold">–ü–æ—Ä–æ–≥: < 9.6%</span>
            </div>
            <div class="calculation-result">
                <span class="calculation-value ${parseFloat(dataElement.dataset.profitabilityEnd) < 9.6 ? 'status-risky' : 'status-safe'}">
                    ${parseFloat(dataElement.dataset.profitabilityEnd) < 9.6 ? 'üî¥ –†–ò–°–ö' : '‚úÖ –ë–ï–ó –†–ò–°–ö–ê'}
                </span>
            </div>
        </div>

        <div class="calculation-details">
            <h5>7. –ù–∏–∑–∫–∞—è —Ä–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—å –∞–∫—Ç–∏–≤–æ–≤</h5>
            <div class="calculation-formula">
                –†–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—å –∞–∫—Ç–∏–≤–æ–≤ = (–ü—Ä–∏–±—ã–ª—å –¥–æ –Ω–∞–ª–æ–≥–æ–æ–±–ª–æ–∂–µ–Ω–∏—è / –ê–∫—Ç–∏–≤—ã) √ó 100%
            </div>
            <div class="calculation-result">
                <span>–†–µ–∑—É–ª—å—Ç–∞—Ç: ${parseFloat(dataElement.dataset.profitabilityAssets).toFixed(2)}%</span>
                <span class="calculation-threshold">–ü–æ—Ä–æ–≥: < 5.4%</span>
            </div>
            <div class="calculation-result">
                <span class="calculation-value ${parseFloat(dataElement.dataset.profitabilityAssets) < 5.4 ? 'status-risky' : 'status-safe'}">
                    ${parseFloat(dataElement.dataset.profitabilityAssets) < 5.4 ? 'üî¥ –†–ò–°–ö' : '‚úÖ –ë–ï–ó –†–ò–°–ö–ê'}
                </span>
            </div>
        </div>

        <div class="calculation-details">
            <h5>8. –°–æ–º–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç—ã</h5>
            <div class="calculation-result">
                <span class="calculation-value ${dataElement.dataset.doubtfulCounterparties === 'true' ? 'status-risky' : 'status-safe'}">
                    ${dataElement.dataset.doubtfulCounterparties === 'true' ? 'üî¥ –†–ò–°–ö (–æ–±–Ω–∞—Ä—É–∂–µ–Ω—ã)' : '‚úÖ –ë–ï–ó –†–ò–°–ö–ê'}
                </span>
            </div>
        </div>

        <div class="calculation-details">
            <h5>9. –ù–µ–ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –ø–æ—è—Å–Ω–µ–Ω–∏–π</h5>
            <div class="calculation-result">
                <span class="calculation-value ${dataElement.dataset.noExplanation === 'true' ? 'status-risky' : 'status-safe'}">
                    ${dataElement.dataset.noExplanation === 'true' ? 'üî¥ –†–ò–°–ö (—Ç—Ä–µ–±—É—é—Ç—Å—è –ø–æ—è—Å–Ω–µ–Ω–∏—è)' : '‚úÖ –ë–ï–ó –†–ò–°–ö–ê'}
                </span>
            </div>
        </div>

        <div class="calculation-details">
            <h5>10. –ß–∞—Å—Ç–∞—è —Å–º–µ–Ω–∞ –º–µ—Å—Ç–æ–Ω–∞—Ö–æ–∂–¥–µ–Ω–∏—è</h5>
            <div class="calculation-result">
                <span class="calculation-value ${dataElement.dataset.locationChange === 'true' ? 'status-risky' : 'status-safe'}">
                    ${dataElement.dataset.locationChange === 'true' ? 'üî¥ –†–ò–°–ö (–æ–±–Ω–∞—Ä—É–∂–µ–Ω–∞)' : '‚úÖ –ë–ï–ó –†–ò–°–ö–ê'}
                </span>
            </div>
        </div>

        <div class="calculation-details">
            <h5>11. –ù–µ–æ–¥–Ω–æ–∫—Ä–∞—Ç–Ω–∞—è —Å–Ω—è—Ç–∏–µ/–ø–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–∞ —É—á–µ—Ç</h5>
            <div class="calculation-result">
                <span class="calculation-value status-safe">
                    ‚úÖ –ë–ï–ó –†–ò–°–ö–ê (–Ω–µ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è)
                </span>
            </div>
        </div>

        <div class="calculation-details">
            <h5>12. –ó–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ —Ä–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç–∏</h5>
            <div class="calculation-formula">
                –û—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ —Ä–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç–∏ –ø—Ä–æ–¥–∞–∂: ${(9.6 - parseFloat(dataElement.dataset.profitabilityEnd)).toFixed(2)}%<br>
                –û—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ —Ä–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç–∏ –∞–∫—Ç–∏–≤–æ–≤: ${(5.4 - parseFloat(dataElement.dataset.profitabilityAssets)).toFixed(2)}%
            </div>
            <div class="calculation-result">
                <span class="calculation-value ${parseFloat(dataElement.dataset.profitabilityEnd) < 5 || parseFloat(dataElement.dataset.profitabilityAssets) < 3 ? 'status-risky' : 'status-safe'}">
                    ${parseFloat(dataElement.dataset.profitabilityEnd) < 5 || parseFloat(dataElement.dataset.profitabilityAssets) < 3 ? 'üî¥ –†–ò–°–ö' : '‚úÖ –ë–ï–ó –†–ò–°–ö–ê'}
                </span>
            </div>
        </div>

        <div class="calculation-details">
            <h5>–ò—Ç–æ–≥–æ–≤—ã–π —Ä–∞—Å—á–µ—Ç —Ä–∏—Å–∫–∞</h5>
            <div class="calculation-formula">
                –û–±—â–∏–π —Ä–∏—Å–∫ = (–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö —Ä–∏—Å–∫–æ–≤ / 12) √ó 100%
            </div>
            <div class="calculation-result">
                <span>–ê–∫—Ç–∏–≤–Ω—ã—Ö —Ä–∏—Å–∫–æ–≤: ${dataElement.dataset.riskCount || 0} –∏–∑ 12</span>
                <span class="calculation-threshold">–û–±—â–∏–π –±–∞–ª–ª: ${dataElement.dataset.riskScore || 0}%</span>
            </div>
        </div>
    `;

    document.getElementById('calculation-content').innerHTML = calculations;
    document.getElementById('calculation-details').style.display = 'flex';
}

// –§—É–Ω–∫—Ü–∏—è –∑–∞–∫—Ä—ã—Ç–∏—è –ø–æ–ø–∞–ø–∞ —Å —Ä–∞—Å—á–µ—Ç–∞–º–∏
function closeCalculationDetails() {
    document.getElementById('calculation-details').style.display = 'none';
}

// –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞—Å—á–µ—Ç–æ–≤
function calculateRevenueGrowth() {
    const dataElement = document.getElementById('analysis-data');
    const start = parseFloat(dataElement.dataset.revenueBaseStart) || 1;
    const end = parseFloat(dataElement.dataset.revenueBaseEnd) || 1;
    return ((end - start) / start) * 100;
}

function calculateCostGrowth() {
    const dataElement = document.getElementById('analysis-data');
    const startCost = (parseFloat(dataElement.dataset.costSalesBaseStart) || 0) + 
                     (parseFloat(dataElement.dataset.commercialExpensesStart) || 0) + 
                     (parseFloat(dataElement.dataset.managementExpensesStart) || 0);
    const endCost = (parseFloat(dataElement.dataset.costSalesBaseEnd) || 0) + 
                   (parseFloat(dataElement.dataset.commercialExpensesEnd) || 0) + 
                   (parseFloat(dataElement.dataset.managementExpensesEnd) || 0);
    return startCost > 0 ? ((endCost - startCost) / startCost) * 100 : 0;
}

// –§—É–Ω–∫—Ü–∏—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ –∫—Ä–∏—Ç–µ—Ä–∏—è
function getCriterionStatus(criterionId) {
    const dataElement = document.getElementById('analysis-data');
    
    switch(criterionId) {
        case 1: return parseFloat(dataElement.dataset.taxBurden) < 8.0;
        case 2: return dataElement.dataset.prbm === 'true';
        case 3: return parseFloat(dataElement.dataset.vatDeduction) >= 89;
        case 4: return dataElement.dataset.optr === 'true';
        case 5: return parseFloat(dataElement.dataset.avgSalary) < 43000;
        case 6: return parseFloat(dataElement.dataset.profitabilityEnd) < 9.6;
        case 7: return parseFloat(dataElement.dataset.profitabilityAssets) < 5.4;
        case 8: return dataElement.dataset.doubtfulCounterparties === 'true';
        case 9: return dataElement.dataset.noExplanation === 'true';
        case 10: return dataElement.dataset.locationChange === 'true';
        case 11: return false; // –ù–µ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –≤ —Ç–µ–∫—É—â–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
        case 12: return parseFloat(dataElement.dataset.profitabilityEnd) < 5 || parseFloat(dataElement.dataset.profitabilityAssets) < 3;
        default: return false;
    }
}

// –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ–ø–∞–ø–æ–≤ –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –∏—Ö
document.getElementById('risk-details').addEventListener('click', function(e) {
    if (e.target === this) {
        closeRiskDetails();
    }
});

document.getElementById('calculation-details').addEventListener('click', function(e) {
    if (e.target === this) {
        closeCalculationDetails();
    }
});

function deleteAnalysis(analysis_id) {
    if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –∞–Ω–∞–ª–∏–∑? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.')) {
        const csrfToken = document.getElementById('analysis-data').dataset.csrfToken;
        const profileUrl = document.getElementById('analysis-data').dataset.profileUrl;
        
        fetch('/analysis/' + analysis_id + '/delete/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': csrfToken
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert(data.message);
                window.location.href = profileUrl;
            } else {
                alert('–û—à–∏–±–∫–∞: ' + data.error);
            }
        })
        .catch(error => {
            alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏: ' + error);
        });
    }
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
document.addEventListener('DOMContentLoaded', function() {
    const dataElement = document.getElementById('analysis-data');
    const criteriaGrid = document.querySelector('.criteria-grid');
    
    if (criteriaGrid) {
        // –°–æ–∑–¥–∞–µ–º –∫–∞—Ä—Ç–æ—á–∫–∏ –¥–ª—è –≤—Å–µ—Ö 12 –∫—Ä–∏—Ç–µ—Ä–∏–µ–≤
        for (let i = 1; i <= 12; i++) {
            const isRisky = getCriterionStatus(i);
            const card = document.createElement('div');
            card.className = `criterion-card ${isRisky ? 'criterion-risky' : 'criterion-safe'}`;
            card.onclick = () => showRiskDetails(i);
            
            card.innerHTML = `
                <div class="criterion-title">
                    <span class="criterion-number">${i}</span>
                    ${riskData[i].title}
                </div>
                <div class="criterion-status ${isRisky ? 'status-risky' : 'status-safe'}">
                    ${isRisky ? 'üî¥ –†–∏—Å–∫ –æ–±–Ω–∞—Ä—É–∂–µ–Ω' : '‚úÖ –†–∏—Å–∫ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç'}
                </div>
            `;
            
            criteriaGrid.appendChild(card);
        }
    }

    // –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è –¥–ª—è –≤—Å–µ—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
    const elements = document.querySelectorAll('.metric-card, .criterion-card, .indicator, .check-item');
    elements.forEach((element, index) => {
        setTimeout(() => {
            element.style.opacity = '0';
            element.style.transform = 'translateY(20px)';
            element.style.transition = 'all 0.5s ease';
            
            setTimeout(() => {
                element.style.opacity = '1';
                element.style.transform = 'translateY(0)';
            }, 50);
        }, index * 100);
    });
});
</script>
{% endblock %}